# 未解決課題と今後の展望

## 優先度: 最高

### OI-01: z値ドリフト

**現象**: 三角測量出力が二峰性（z=1.3m vs z=6.5m）を示す。自動キャリブレーションが異常値で発動してしまう。

**影響**: アバターが前後に大きくジャンプする。

**対策案**:
- 値の妥当性チェック（z値の時間的一貫性）
- 再投影エラー閾値の調整
- 自動キャリブレーションの発動条件厳格化

**出典**: HANDOVER.md

## 優先度: 高

### OI-02: 右側キーポイント欠落

**現象**: R_foot、R_kneeがほぼ出現しない。

**影響**: 右足・右膝トラッカーが動作しない。

**原因候補**: カメラ配置・角度の問題で右側が見えにくい。

**出典**: HANDOVER.md

### OI-03: L_footフリーズ

**現象**: L_footが同一座標に長時間固着する。

**影響**: 左足トラッカーが動かない。

**原因候補**: ステールタイムアウトが正しく機能していない可能性。

**出典**: HANDOVER.md

### OI-04: no pose頻度が高い

**現象**: ポーズ検出成功率が半分以下。正当なキーポイントも再投影エラーで棄却されている可能性。

**影響**: トラッカーデータの欠損が多い。

**対策案**: 再投影エラー閾値（120px）の再調整。

**出典**: HANDOVER.md

## 優先度: 中

### OI-05: 送信遅延 0.5-1s

**現象**: 三角測量モード導入後に0.5-1sの遅延が報告された。

**影響**: アバターの動きがユーザーの動きに追従しない。

**出典**: セッション記録

### OI-06: R_kneeの非対称

**現象**: hip→L_knee=0.59m vs hip→R_knee=1.33m（scale後）。scale前でも0.20m vs 0.44m。

**状態**: 立ち方次第で正常範囲の可能性あり。要実地確認。

**出典**: MEMORY.md

### OI-07: スケール値の問題

**現象**: 三角測量はメートル単位出力なのにscale_x=3.0等が掛かっている。

**疑問**: world_coordsモードではscale≈1.0にすべきか？

**現状**: world_coordsモードではscale_x/y=1.0を強制する実装あり。だが設定ファイルの値との整合性が不明確。

**出典**: MEMORY.md

### OI-08: chestトラッカーのジャンプ

**現象**: ステールタイムアウト後に速度チェックなしで大きなジャンプを受け入れる。

**対策**: max_displacement=0.4で部分対処済みだが、ステール復帰時の特別処理が不足。

**出典**: MEMORY.md

### OI-09: 肩キーポイント y=0.00

**現象**: 上半身がフレーム外で肩のy座標が0.00になる。

**原因**: カメラ設置位置が肩の高さのため。

**出典**: MEMORY.md

### OI-10: トラッカー回転精度の向上

現状の回転実装:
- **Yaw（Y軸）**: 全トラッカーで実装済み
- **Pitch（X軸）**: 膝のみ、world_coordsモード時のみ
- **Roll（Z軸）**: 未実装

**残課題**:
- 膝pitchの2Dフォールバック未実装（3Dからの計算は実装済み）
- 腰・胸のpitch（前傾・後傾）が未対応
- roll（体の左右傾き）が全トラッカーで未対応
- 「体の回転も正確に反映する必要がある」というユーザー要求あり

**出典**: memo.txt、セッション記録

### OI-11: 足位置のheel/toeキーポイント活用

**現状**: ankleベースにfoot_y_offsetで補正。heel or (ankle+heel)/2でより地面に近い位置を得られる可能性。

**ユーザー決定**: 「いったんオフセット調整で」。本格対応は後回し。

**出典**: memo.txt

### OI-12: knee/footトラッカーのz軸後退

**現象**: 膝と足のトラッカーがVR空間でz軸方向に実際の位置より後退する。

**確認状況**: 実地テストでユーザーが確認済み（2026-02-18）。

**原因候補**:
- 三角測量時のカメラペア選択によるz値バイアス
- 下半身キーポイントの再投影エラーが上半身より大きい（カメラが肩の高さのため、下半身は急角度で撮影）
- hip基準ペア固定が下半身には不適切な可能性（hipと四肢でカメラからの見え方が異なる）
- z軸の座標変換（カメラ→VR）での符号・オフセットの問題

**影響**: アバターの膝・足が体より後ろに引っ込む。IKの破綻や不自然な姿勢の原因になる。

### OI-13: 下半身の動き出し遅延

**現状**: position_beta=0.3に変更済みでユーザー了承。

**残課題**: Beat Saberプレイ中の実運用で追加調整が必要な可能性。

**出典**: memo.txt

## 優先度: 低

### OI-14: undistort_point()の収束未確認

**現象**: k1=-1.29, k3=-33.4は異常に大きい歪み係数。Newton-Raphson法（30回反復）で収束しているか未確認。

**暫定対処**: 歪み係数を[0,0,0,0,0]で上書き。

**出典**: HANDOVER.md

### OI-15: Camera 4のキャリブレーション破損

**現象**: fx/fy=0.654（正常は~1.0付近ではない、焦点距離ピクセル単位で数百が正常）。

**対処**: 再キャリブレーション必要。

**出典**: memo.txt

### OI-16: FPS向上

**案**:
- Camera 4の推論停止でcam0+cam3の推論頻度を上げる
- spinepose_smallへの切替
- CoreML対応（効果限定的: 6ms→3ms）

**ユーザー意見**: 「3台の方が精度出るのでは？」→ Camera 4再キャリブが正解

**出典**: memo.txt

### OI-17: 曲の開始20秒付近から足のトラッキングが怪しくなる

**現象**: Beat Saber撮影テストで報告。時間経過で足トラッキングが劣化。

**原因**: 不明。人物検出のドリフト、またはフィルタ状態の蓄積か。

**出典**: セッション記録

## 今後の展望（未要求だが技術的に可能なもの）

以下は現時点でユーザーから明示的に要求されていないが、コードベースやモデル能力から実現可能なもの。

- 顔のキーポイント活用（Head/Nose/Eye/Ear）
- 手のキーポイント活用（RTMW3Dの133点に手指を含む）
- ハンドトラッキング（VMTの`/VMT/Skeleton/*`対応）
- リアルタイム適応キャリブレーション
- GPU推論最適化（CoreML以外のアクセラレータ）
